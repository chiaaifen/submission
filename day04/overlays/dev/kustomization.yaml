apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

# what are the resources that you can customise
resources: 
- ../../base
- config.yaml

namespace: dev-ns

# all resources will be named with dev-
namePrefix: dev-

# add metadata 
# templates - just the root or its child (deployment vs pod)
labels: 
- pairs:
    env: dev
  includeSelectors: true
  includeTemplates: true

# change the replicas (most common)
replicas: 
- name: dov-deploy
  count: 1

# test new image test (also very common)
images: 
- name: chukmunnlee/dov-bear
  newTag: v5

configMapGenerator:
- name: dov-cm
  behavior: create
  literals:
  - INSTANCE_NAME='configmap generated by kustomize"

# auto base64 for you
# can do k get cm,secrets -ndev-ns to check created ones
# can create unique secrets!

# once deployed, do a k get deploy/<deploy_name> 
# check the environment variables, it is smart enought to change the config name -> base deploy file will dynamically change the configmap reference for diff people
secretGenerator:
- name: dov-secret
  behavior: create
  literals:
  - API_KEY=my-api-key
    INSTANCE_HASH=abcd1234

# doing patching to a deployment
# all patches for 1 resource must be in 1 patch file -> usually diff patch files for diff resources
# cannot patch the same resource twice!! needs knowledge of what has been patched
# BEFORE WRITING PATCH FILE, look at kustomisation documentation to see if we can do it in a simpler way via kustomisation
patches: 
- target: 
    group: apps
    version: v1
    kind: deployment
    name: dov-deploy
  path: patch.yaml

